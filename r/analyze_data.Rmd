---
title: "Analyze Data"
author: "Haruta Tasaki"
date: "2024-06-08"
output: html_document
---

# Analyze Data

## Libraries
```{r}
library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(lubridate)
```


## Import Data
```{r}
daily_activity <- read_csv("../cleaned_data/daily_activity.csv")
heartrate_seconds <- read_csv("../cleaned_data/heartrate_seconds.csv")
sleep_day <- read_csv("../cleaned_data/sleep_day.csv")
weight_log <- read_csv("../cleaned_data/weight_log.csv")
```

## Statistical Data

All Perticipants:
```{r}
users <- unique(c(daily_activity$Id, heartrate_seconds$Id, sleep_day$Id, weight_log$Id))
sprintf("Number of users: %d", length(users))
```

Perticipants for each data log:
```{r}
num_unique_ids <- function (data) {
  return(length(unique(data$Id)))
}

sprintf("Daily Activity: %d", num_unique_ids(daily_activity))
sprintf("Heartrate: %d", num_unique_ids(heartrate_seconds))
sprintf("Sleep: %d", num_unique_ids(sleep_day))
sprintf("Weight: %d", num_unique_ids(weight_log))
```



## Heartrate

### Aggregation

Number of participants:
```{r}
heartrate_seconds |>
  distinct(Id) |>
  nrow()
```


Total summary of heart rate
```{r}
heartrate_seconds |>
  summarise(
    Max = max(Value),
    Min = min(Value),
    Average = mean(Value)
  )
```

Total summary by participant
```{r}
heartrate_seconds |>
  group_by(Id) |>
  summarise(
    Max = max(Value),
    Min = min(Value),
    Average = mean(Value)
  )
```

Reduce rows
```{r}
heartrate_seconds_v2 <- heartrate_seconds |>
  mutate(Time = cut(Time, breaks = "10 min")) |>
  group_by(Id, Time) |>
  summarise(Value = mean(Value, na.rm = TRUE))
nrow(heartrate_seconds)
nrow(heartrate_seconds_v2)
```

Function produces data by date
```{r}
heartrate_by_date = function(date) {
  data <- heartrate_seconds_v2 |>
    filter(as.Date(Time) == as.Date(date))
  return(data)
}

head(heartrate_by_date("2016-05-01"))
```



### Visualization

```{r}
date <- "2016-05-01"
day <- wday(date, label=TRUE)
ggplot(data = heartrate_by_date(date)) +
  geom_line(mapping = aes(x = Time, y = Value, group = Id, color = Id)) +
  labs(title = sprintf("Heartrate Graph: %s (%s)", date, day), x = "Time", y = "Heartrate") +
  facet_wrap(~Id)+
  theme(
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    legend.position = "none"
    )
```

Case ID: 6775888955
```{r}
heartrate_seconds_date <- heartrate_seconds_v2 |>
  mutate(Date = as.Date(Time))

heartrate_seconds_date |>
  filter(Id == 6775888955) |>
  ggplot() +
  geom_line(mapping = aes(x = Time, y = Value, group = Date)) +
  facet_wrap(~Date) +
   theme(
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    legend.position = "none"
    )
```



## Daily Activity

daily_activity has columns:
```{r}
colnames(daily_activity)
```
### Summarize

Average values
```{r}
avg_activity <- daily_activity |>
  group_by(Id) |>
  select(-Date) |>
  summarise(
    Steps = mean(TotalSteps),
    Distance = mean(TotalDistance),
    Calories = mean(Calories),
    VeryActiveMinutes = mean(VeryActiveMinutes)
            )
head(avg_activity)
```

Visualize average: Steps - Distance
```{r}
ggplot(data = avg_activity) +
  geom_point(mapping=aes(x = Steps, y = Distance))
```

Visualize average: Distance - Calories
```{r}
ggplot(data = avg_activity) +
  geom_point(mapping=aes(x = Distance, y = Calories))
```

Visualize average: VeryActiveMinutes - Calories
```{r}
ggplot(data = avg_activity) +
  geom_point(mapping=aes(x = VeryActiveMinutes, y = Calories))
```


## Sleep

### Summary

Sleep Records:
```{r}
sleep_day |>
  summarise(
    Max = max(TotalSleepRecords),
    Min = min(TotalSleepRecords)
  )
```
Most frequent sleep records:
```{r}
num_sleep_day <- sleep_day |>
  mutate(NumSleep = as.character(TotalSleepRecords)) |>
  select(-TotalSleepRecords) |>
  group_by(NumSleep) |>
  summarise(
    Count = n()
  )

num_sleep_day

ggplot(num_sleep_day, aes(x = "", y = Count, fill = NumSleep)) +
  geom_col() +
  coord_polar(theta = "y") +
  theme_void()
```

Percentages of NumSleep:
```{r}
all_count = sum(num_sleep_day$Count)
num_sleep_day |>
  mutate(
    Rate = Count / all_count
  )
```


Sleep Minutes:
```{r}
ggplot(data = sleep_day) +
  geom_line(mapping = aes(x = Date, y = TotalMinutesAsleep, group = Id)) +
  facet_wrap(~Id)
```

## Weight

Number of participants:
```{r}
weight_log |>
  distinct(Id) |>
  nrow()
```


Average:
```{r}
avg_weight <- weight_log |>
  group_by(Id) |>
  summarise(
    WeightKg = mean(WeightKg),
    BMI = mean(BMI)
  )
avg_weight
```

BMI By Category:
```{r}
cat_bmi <- function (bmi) {
  if (bmi < 18.5) {
    return("Underweight")
  } else if (bmi < 25) {
    return("Healthy weight")
  } else if (bmi < 30) {
    return("Overweight")
  } else {
    return("Obese")
  }
}

avg_bmi_cat <- avg_weight |>
  mutate(BMI_Category = sapply(BMI, cat_bmi)) |>
  select(Id, BMI, BMI_Category)

ggplot(avg_bmi_cat, aes(x = "", y = BMI_Category, fill = BMI_Category)) +
  geom_col() +
  coord_polar(theta = "y") +
  theme_void()

```

Percentages of BMI Categories:
```{r}
num_entries <- nrow(avg_bmi_cat)
avg_bmi_cat |>
  group_by(BMI_Category) |>
  summarise(
    Count = n(),
    Rate = n() / num_entries
  )
```



Count of Valid Fat Value:
```{r}
weight_log |>
  filter(Fat > 0) |>
  nrow()
```

